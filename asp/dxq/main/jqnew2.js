if(typeof(Array.prototype.push)!="function"){Array.prototype.push=function(){for(var a=0;a<arguments.length;a++){this[this.length]=arguments[a];}return this.length;};}String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c];});};var hrefSave=document.getElementById("hrefSave");var cur_page=0;var jumpPages;var pageHolder=new Array();var trapHolder=new Array();var totalQ=0;var completeLoaded=false;var MaxTopic=0;if(displayPrevPage=="none"&&(hasJoin=="1"||isSuper)){displayPrevPage="";}var curdiv=null;var curfilediv=null;var isUploadingFile=false;var hasZhenBiePage=false;var progressArray=new Object();var questionsObject=new Object();var joinedTopic=0;var randomparm="";var hasTouPiao=false;var useSelfTopic=false;var isChrome=window.chrome;document.oncontextmenu=document.ondragstart=document.onselectstart=document.onmouseup=avoidCopy;var ZheZhaoControl=null;var verifyCodeErrorTimes=0;if(!isChrome){try{document.oncopy=avoidCopy;}catch(ex){}}function avoidCopy(b){b=window.event||b;var a;if(b){if(b.target){a=b.target;}else{if(b.srcElement){a=b.srcElement;}}if(a.nodeType==3){a=a.parentNode;}if(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT"){return true;}}if(document.selection&&document.selection.empty){document.selection.empty();}return false;}var needCheckLeave=true;if(allowSaveJoin&&isRunning=="true"&&guid){window.onunload=function(){if(needCheckLeave){if(confirm("您要保存填写的答卷吗？")){submit(2);alert("答卷保存成功！");}}};}$=function(a){return document.getElementById(a);};$$=function(a,b){if(b){return b.getElementsByTagName(a);}else{return document.getElementsByTagName(a);}};function getTop(b){var a=b.offsetLeft;var c=b.offsetTop;while(b=b.offsetParent){a+=b.offsetLeft;c+=b.offsetTop;}return{x:a,y:c};}function addEventSimple(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);}else{if(c.attachEvent){c.attachEvent("on"+a,b);}}}function removeEventSimple(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false);}else{if(c.detachEvent){c.detachEvent("on"+a,b);}}}function Request(d){var b=window.document.location.href;var f=b.indexOf("?");var e=b.substr(f+1);var c=e.split("&");for(var a=0;a<c.length;a++){var g=c[a].split("=");if(g[0].toUpperCase()==d.toUpperCase()){return g[1];}}return"";}var txtCurCity=null;function openCityBox(d,c){txtCurCity=d;ZheZhaoControl=txtCurCity;if(c==3){var a=d.getAttribute("province");var b="";if(a){b="&pv="+encodeURIComponent(a);}PDF_launch("/wjx/design/setcitycounty.aspx?activityid="+activityId+"&ct="+c+b,470,220);}else{PDF_launch("/wjx/design/setcity.aspx?activityid="+activityId+"&ct="+c,470,220);}}function setCityBox(a){txtCurCity.value=a;}var submit_tip=$("submit_tip");var submit_div=$("submit_div");function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"");}function isInt(a){var b=/^-?[0-9]+$/;return b.test(a);}function replace_specialChar(a){return a.replace(/(§)/g,"ξ").replace(/(¤)/g,"○").replace(/(〒)/g,"╤").replace(/(┋)/g,"|").replace(/(<)/g,"&lt;");}function isRadioImage(a){if(!a||a=="0"||a=="1"||a=="101"){return false;}else{return true;}}function isRadioRate(a){return a!=""&&a!="0"&&a!="1"&&a!="-1";}var submit_table=$("submit_table");var pre_page=$("btnPre");var next_page=$("btnNext");var submit_button=$("submit_button");var imgCode=$("imgCode");var submit_text=$("txtCode");var tCode=$(tdCode);var divMinTime=$("divMinTime");var spanMinTime=$("spanMinTime");var divMaxTime=$("divMaxTime");var spanMaxTime=$("spanMaxTime");var maxCounter=0;var maxTimer=null;function changeHeight(d){if(isChrome){return;}var c=18;var b=100;var a=d.scrollHeight;a=a>c?a:c;a=a>b?b:a;d.style.height=a+"px";}function fcInputboxFocus(){}function lengthChange(c){var a=c.value.length;var b=c.size;if(a>=b&&b<=80){c.size=a+2;}else{if(b>80){}}}function fcInputboxBlur(){if(!this.value){this.value=defaultOtherText;this.style.color="#999999";}else{this.style.color="#000000";if(langVer!=0){return;}var e=this.parent;var c=e.itemInputs;var f=this.value.split(/(,|，)/ig);for(var d=0;d<c.length;d++){var b=c[d].nextSibling;if(b&&b.nodeType==3){b=b.nextSibling;}if(!b){return;}for(var a=0;a<f.length;a++){if(trim(f[a].toLowerCase())==trim(b.innerHTML.toLowerCase())){alert("提示：您输入的“"+f[a]+"”已经包含在题目选项当中");c[d].checked=true;b.style.color="red";}}}}}function isTextBoxEmpty(a){a=trim(a);if(a==""||a==defaultOtherText){return true;}return false;}function refresh_validate(){if(imgCode&&tCode.style.display!="none"){imgCode.src="/AntiSpamImageGen.aspx?q="+activityId+"&t="+(new Date()).valueOf();}}function enter_clicksub(a){a=a||window.event;if(a&&a.keyCode==13){submit(1);}}var relationHT=new Array();var relationQs=new Object();var relationNotDisplayQ=new Object();var nextPageAlertText="";var yucVerify=false;Init();var ajax_proc_func=function(a){if(a==1){yucVerify=true;show_status_tip("<span style='color:green;background:white;font-size:16px; padding-left:10px;height:30px;line-height:30px; display:block;width:200px;'>验证码输入正确<img src='http://image.sojump.com/images/Master_Images/WjxVip/complete.gif' alt=''></span>",3000);tCode.style.display="none";if($("YMADSDivId")){$("YMADSDivId").style.visibility="hidden";}}else{yucVerify=false;}};function Init(){if(cur_page==0&&!displayPrevPage&&pre_page){pre_page.style.display="";pre_page.disabled=true;}pageHolder=$$("fieldset",survey);for(var ab=0;ab<pageHolder.length;ab++){var U=pageHolder[ab].getAttribute("skip")=="true";if(U){pageHolder[ab].skipPage=true;}}submit_button.onclick=function(){submit(1);};if(isPub){$("spanTest").style.display="";$("submittest_button").onclick=function(){if(!isTest&&confirm("试填后的答卷不会参与结果统计，确定试填吗？")){submit(5);}else{if(isTest){submit(5);}}};if(isTest){submit_button.style.display="none";}}if(hasJoin=="3"){submit_button.onclick=function(){if(window.confirm("确定编辑此答卷吗？")){submit(6);}};}if(totalPage==1&&isRunning=="true"&&hasJoin!="1"){submit_table.style.display="";}else{if(isRunning!="true"){var n=$("spanNotSubmit");if(n&&trim(n.innerHTML)!=""){if(totalPage==1&&hasJoin!="1"){submit_table.style.display="";}nextPageAlertText=n.innerHTML.replace(/<[^>]*>/g,"");submit_button.onclick=function(){alert(nextPageAlertText);n.scrollIntoView();};}else{submit_table.style.display="none";}}else{submit_table.style.display="none";}}if(pre_page){pre_page.onclick=show_pre_page;}if(next_page){next_page.onclick=show_next_page;}if(tCode&&tCode.style.display!="none"&&isRunning=="true"){submit_text.value=validate_info_submit_title3;addEventSimple(submit_text,"blur",function(){if(submit_text.value==""){submit_text.value=validate_info_submit_title3;}});addEventSimple(submit_text,"focus",function(){if(submit_text.value==validate_info_submit_title3){submit_text.value="";}});imgCode.style.display="none";if(langVer!=0){imgCode.alt="";}addEventSimple(submit_text,"click",function(){var i=$("YMADSDivId");var k=false;if(needAvoidCrack==1&&!i){k=true;}if(needAvoidCrack==1&&!window.AvoidCrackSetOpen&&verifyCodeErrorTimes>=2){k=true;}if(imgCode.style.display==""){k=true;}if(k){needAvoidCrack=0;if($("YMADSDivId")){$("YMADSDivId").style.visibility="hidden";}submit_text.onkeyup=null;}verifyCodeErrorTimes++;if(!needAvoidCrack&&imgCode.style.display=="none"){imgCode.onclick=refresh_validate;imgCode.onclick();imgCode.style.display="";imgCode.title=validate_info_submit_title1;}});submit_text.onkeyup=function(){if(needAvoidCrack==1){Yucmedia_ajax_verify("txtCode","ajax_proc_func");}};}for(var Z=0;Z<pageHolder.length;Z++){var e=$$("div",pageHolder[Z]);if(hasJoin){pageHolder[Z].style.display="";}var h=new Array();var W=0;for(var ab=0;ab<e.length;ab++){if(e[ab].className.toLowerCase()=="div_question"){var d=e[ab].getAttribute("istrap")=="1";e[ab].onclick=divQuestionClick;if(d){trapHolder.push(e[ab]);initItem(e[ab]);e[ab].pageIndex=Z+1;e[ab].isTrap=true;}else{e[ab].indexInPage=W;h[W]=e[ab];h[W].pageIndex=Z+1;W++;totalQ++;}}}pageHolder[Z].questions=h;}set_data_fromServer(qstr);var H=new Array();for(var o=0;o<pageHolder.length;o++){var ad=pageHolder[o].questions;for(var ab=0;ab<ad.length;ab++){var F=ad[ab].dataNode;var ak=F._type;var x=ad[ab].getAttribute("relation");if(x&&x!="0"){var L=x.split(",");var E=L[0];var b=L[1].split(";");for(var K=0;K<b.length;K++){var m=E+","+b[K];if(!relationHT[m]){relationHT[m]=new Array();}relationHT[m].push(ad[ab]);}if(!relationQs[E]){relationQs[E]=new Array();}relationQs[E].push(ad[ab]);relationNotDisplayQ[F._topic]="1";}if(ak!="page"&&ak!="cut"){questionsObject[F._topic]=ad[ab];}if(ak=="radio"||ak=="check"){if(ak=="radio"&&isRadioImage(F._mode)){initLikertItem(ad[ab]);}else{initItem(ad[ab]);}if((ak=="radio"||ak=="check")&&!F.isRate){var R=$$("img",ad[ab]);for(var aa=0;aa<R.length;aa++){R[aa].onclick=function(){var i=this.getAttribute("rel");if(i){var q=$(i);q.click();var k=q.parent.parent||q.parent;this.style.border=q.checked?"solid 2px #ff9900":"solid 2px #eeeeee";if(q.type=="radio"){if(k&&k.prevImage&&k.prevImage!=this){k.prevImage.style.border="";}k.prevImage=this;}}};}}}if(ak=="fileupload"){var g=$$("iframe",ad[ab]);if(g&&g[0]){ad[ab].uploadFrame=g[0];ad[ab].uploadFrame.allowTransparency=true;var u=document.frames?document.frames[g[0].id]:document.getElementById(g[0].id).contentWindow;u.curdiv=ad[ab];u._ext=F._ext;}var e=$$("div",ad[ab]);for(var aa=0;aa<e.length;aa++){if(e[aa].className.toLowerCase()=="uploadmsg"){ad[ab].uploadmsg=e[aa];e[aa].style.color="red";break;}}ad[ab].uploadFinish=function(i,q){this.uploadmsg.innerHTML=i;this.fileName=q;isUploadingFile=false;this.uploadFrame.style.display="";var k=document.frames?document.frames[this.uploadFrame.id]:document.getElementById(this.uploadFrame.id).contentWindow;k.curdiv=this;k._ext=this.dataNode._ext;jump(this,this.uploadFrame);};}if(ak=="matrix"){var f=F._mode;if(F._hasjump){if(f&&f-100<0){initLikertItem(ad[ab]);}else{initItem(ad[ab]);}}var c=ad[ab].getAttribute("DaoZhi");var ah=null;if(!c){ah=$$("tr",ad[ab]);}else{var Q=$$("tr",ad[ab]);ah=new Array();var r=Q[0].cells.length-1;for(var v=0;v<r;v++){ah[v]=Q[0].cells[v+1];ah[v].itemInputs=new Array();}for(var v=0;v<r;v++){for(var a=0;a<Q.length;a++){var G=Q[a].cells[v+1];G.parent=ah[v];G.onclick=function(){if(curMatrixItem!=this.parent){var i=this.parent.itemInputs;for(var k=0;k<i.length;k++){i[k].parentNode.style.background="#fbd5b5";}if(curMatrixItem&&curMatrixItem.daoZhi){i=curMatrixItem.itemInputs;for(var k=0;k<i.length;k++){i[k].parentNode.style.background="";}}divMatrixItemClick.call(this.parent);}};ah[v].parent=ad[ab];ah[v].daoZhi=true;var ac=G.getElementsByTagName("input")[0];if(ac){ah[v].itemInputs.push(ac);}}}}if(!c){for(var aa=0;aa<ah.length;aa++){if(f!="303"){if(f&&f-100<0){initLikertItem(ah[aa]);}else{if(!c){initItem(ah[aa]);}}}else{var V=$$("select",ah[aa]);if(V.length>0){ah[aa].itemSels=V;}if(F._hasjump){for(var ae=0;ae<V.length;ae++){V[ae].parent=ah[aa];V[ae].onchange=function(){var an=this.parent.parent;var am=an.itemTrs;var al=false;for(var k=0;k<am.length;k++){var q=am[k].itemSels;if(!q){continue;}for(var i=0;i<q.length;i++){if(q[i].value){al=true;break;}}if(al){break;}}jumpAny(al,an);};}}}ah[aa].parent=ad[ab];ah[aa].onclick=divMatrixItemClick;}}if(f=="301"){var t=ad[ab].getAttribute("minvalue");var z=ad[ab].getAttribute("maxvalue");ad[ab].dataNode._minvalue=t;ad[ab].dataNode._maxvalue=z;}if(ah.length>0){ad[ab].itemTrs=ah;}}if(ak=="sum"){initItem(ad[ab]);var ah=$$("tr",ad[ab]);var s=new Array();for(var aa=0;aa<ah.length;aa++){var P=$$("input",ah[aa]);if(P.length>0){ah[aa].parent=ad[ab];s.push(ah[aa]);}}var p=ad[ab].itemInputs.length;var l=ad[ab].itemInputs;for(var aa=0;aa<p;aa++){l[aa].onblur=function(){txtChange(this);};}if(s.length>0){ad[ab].itemTrs=s;}var J=ad[ab].getAttribute("rel");ad[ab].relSum=$(J);}if(ak=="check"&&F.isSort){var aj=$$("a",ad[ab]);for(aa=0;aa<aj.length;aa++){aj[aa].onclick=itemSortClick;}}if(ak=="question"){var T=$$("textarea",ad[ab]);if(T.length>0){T[0].onkeypress=function(){txtChange(this);};if(!T[0].onclick){T[0].onclick=T[0].onkeypress;}T[0].onblur=T[0].onchange=function(){txtChange(this,1);};T[0].parent=ad[ab];ad[ab].itemTextarea=T[0];}}else{if(ak=="gapfill"){var T=$$("input",ad[ab]);for(var B=0;B<T.length;B++){T[B].onkeypress=function(){txtChange(this);};if(!T[B].onclick){T[B].onclick=T[B].onkeypress;}T[B].onblur=T[B].onchange=function(){txtChange(this,1);};T[B].parent=ad[ab];}ad[ab].gapFills=T;}}if(ak=="radio_down"||(ak=="check"&&F._mode)){var I=$$("select",ad[ab]);if(I.length>0){I[0].onchange=itemClick;I[0].parent=ad[ab];ad[ab].itemSel=I[0];}}var af=null;if(ad[ab].dataNode._hasjump){af=$$("label",ad[ab]);for(var S=0;S<af.length;S++){if(af[S].id.indexOf("divJump")>-1){ad[ab].jumpInfo=af[S];}}}var Y=$$("div",ad[ab]);var N=0;var M=null;for(aa=0;aa<Y.length;aa++){if((ak=="radio"||ak=="check")&&!F.isRate){var O=Y[aa].getAttribute("rel");if(O){Y[aa].onclick=function(){var k=this.getAttribute("rel");var i=$(k);i.click();};}}if(Y[aa].className.toLowerCase()=="div_title_question"){ad[ab].divTitle=Y[aa];}else{if(Y[aa].className.toLowerCase()=="slider"){if(ak=="matrix"||ak=="sum"){M=Y[aa].parentNode.parentNode;N++;}else{if(ak=="slider"){M=ad[ab];}}M.divSlider=Y[aa];Y[aa].parent=M;var t=Y[aa].getAttribute("minvalue");var z=Y[aa].getAttribute("maxvalue");ad[ab].dataNode._minvalue=t;ad[ab].dataNode._maxvalue=z;var X;if(ak=="sum"){X=M.getElementsByTagName("input")[0];}else{var ai=Y[aa].getAttribute("rel");X=$(ai);}var ag=new neverModules.modules.slider({targetId:Y[aa].id,sliderCss:"imageSlider1",barCss:"imageBar1",min:parseInt(t),max:parseInt(z),sliderValue:X,hints:slider_hint,change:itemClick});ag.create();M.sliderImage=ag;var A=Y[aa].getAttribute("defvalue");if(A&&isInt(A)){ag.setValue(parseInt(A));M.divSlider.value=parseInt(A);if(ak=="sum"){if(hasJoin&&A){if(ad[ab].sumLeft==undefined){ad[ab].sumLeft=F._total-parseInt(A);}else{ad[ab].sumLeft=ad[ab].sumLeft-parseInt(A);}}else{ad[ab].sumLeft=0;}}}if(hasJoin=="1"){ag._slider.onclick=function(){};ag._initMoveSlider=function(){};}}}}if(ak=="matrix"){var w=new Array();var ah=ad[ab].itemTrs;for(var aa=0;aa<ah.length;aa++){var y=ah[aa].itemInputs||ah[aa].itemLis||ah[aa].divSlider||ah[aa].itemSels;if(y){w.push(ah[aa]);}}if(w.length>0){ad[ab].itemTrs=w;}}if(F&&F._hasjump){cur_page=o;if(hasJoin){jumpJoin(ad[ab],o);}else{clearAllOption(ad[ab]);}cur_page=0;}if(F._referedTopics){H.push(ad[ab]);}if(hasJoin&&window.cancelInputClick){cancelInputClick(ad[ab]);}}if(o>0&&hasJoin){pageHolder[o].style.display="none";}}completeLoaded=true;for(var ab=0;ab<H.length;ab++){var W=H[ab];createItem(W);}for(var o=0;o<pageHolder.length;o++){var ad=pageHolder[o].questions;for(var ab=0;ab<ad.length;ab++){var F=ad[ab].dataNode;var D=F._topic;if(relationQs[D]){if(hasJoin){relationJoin(ad[ab]);}else{clearAllOption(ad[ab]);}}}}if(lastSavePage>0){pageHolder[0].style.display="none";cur_page=lastSavePage-1;show_next_page(true);}if(lastSaveQ>=1){var C=$("div"+lastSaveQ);if(C){C.scrollIntoView();C.onclick();joinedTopic=lastSaveQ;for(var ab=1;ab<=lastSaveQ;ab++){progressArray[ab+""]=true;}showProgressBar();}}if(totalQ==0){submit_table.style.display="none";}processMinMax();showProgressBar();}var prevPostion;var resizedMax;function processMinMax(){if(maxTimer){clearInterval(maxTimer);}if(isRunning=="true"){var c=pageHolder[cur_page]._maxtime;if(c){var d=c>10?10:1;maxCounter=c;divMaxTime.style.position="absolute";addEventSimple(window,"scroll",mmMaxTime);addEventSimple(window,"resize",resizeMaxTime);mmMaxTime();divMaxTime.style.display="";spanMaxTime.innerHTML=c;maxTimer=setInterval(function(){maxCounter--;spanMaxTime.innerHTML=maxCounter;if(maxCounter<=0){clearInterval(maxTimer);divMaxTime.style.display="none";pageHolder[cur_page].hasExceedTime=true;if(cur_page<totalPage-1){show_next_page();}else{if(tCode.style.display=="none"){submit(1);}}}},1000);}var b=pageHolder[cur_page]._mintime;if(b){if(!isSuper){if(next_page){next_page.disabled=true;}submit_button.disabled=true;}divMinTime.style.display="";addEventSimple(window,"resize",resizeMinTime);resizeMinTime();spanMinTime.innerHTML=b;var a=b;var e=setInterval(function(){a--;spanMinTime.innerHTML=a;if(a<=0){clearInterval(e);if(next_page){next_page.disabled=false;}submit_button.disabled=false;divMinTime.style.display="none";}},1000);}}}function resizeMaxTime(){resizedMax=true;mmMaxTime();}function mmMaxTime(){var b=document.documentElement.scrollTop||document.body.scrollTop;var a=getTop(survey);var d=a.x-54;var c=b+a.y-40;if(d<=0){d=qwidth-10;c=b+a.y+10;}divMaxTime.style.top=c+"px";divMaxTime.style.left=d+"px";}function resizeMinTime(){var b;b=submit_table.style.display=="none"?next_page:submit_table.lastChild;var a=getTop(b);divMinTime.style.left=(a.x+b.offsetWidth+10)+"px";divMinTime.style.top=a.y+2+"px";}function initItem(e){var c=$$("input",e);if(c.length==0){c=$$("textarea",e);}for(var d=0;d<c.length;d++){c[d].parent=e;if(!c[d].onclick){c[d].onclick=itemClick;}if(c[d].tagName=="TEXTAREA"){c[d].onchange=c[d].onblur=itemClick;}var b=c[d].getAttribute("rel");if(b){var a=$(b);a.itemText=c[d];c[d].choiceRel=a;c[d].onblur=fcInputboxBlur;if(!c[d].value){c[d].value=defaultOtherText;}c[d].style.color="#999999";var f=c[d].getAttribute("req");if(f=="true"){a.req=true;}else{a.req=false;}}}if(c.length>0){e.itemInputs=c;}}function initLikertItem(b){var e=$$("li",b);var a=new Array();var f=false;var d;for(j=0;j<e.length;j++){var c=e[j].className.toLowerCase();if(e[j].className&&(c.indexOf("off")>-1||c.indexOf("on")>-1)){e[j].onclick=itemLiClick;e[j].onmouseover=itemMouseOver;e[j].onmouseout=itemMouseOut;e[j].parent=b;a.push(e[j]);if(c.indexOf("on")>-1){d=e[j];}else{if(c.indexOf("off")>-1&&d){d.parent.holder=d.value;}}}}if(e.length>0){if(d){d.parent.holder=d.value;}b.itemLis=a;}}function createItem(g){var o=g.dataNode;var n=o._referedTopics.split(",");var e=new Array();for(var f=0;f<g.itemInputs.length;f++){if(g.itemInputs[f].checked){e.push(g.itemInputs[f]);}}for(var f=0;f<n.length;f++){var c=n[f];var b=questionsObject[c];if(!b){continue;}var s=false;var a=document.getElementById("divRef"+c);var k=0;switch(b.dataNode._type){case"matrix":case"sum":var r=b.itemTrs[0].itemInputs||b.itemTrs[0].itemLis||b.itemTrs[0].divSlider||b.itemTrs[0].itemSels;if(!r){k=1;}for(var d=0;d<g.itemInputs.length;d++){var h=g.itemInputs[d];if(!h.value||h.type!="checkbox"){continue;}var i=parseInt(h.value)-1+k;if(!b.itemTrs[i]){break;}b.itemTrs[i].style.display=h.checked?"":"none";if(h.checked){s=true;}if(hasJoin&&b.itemTrs[i].divSlider){var p=b.itemTrs[i].divSlider.getAttribute("defvalue");if(p&&isInt(p)){b.itemTrs[i].sliderImage.setValue(parseInt(p));}}}if(k==1){b.itemTrs[0].style.display=s?"":"none";}a.style.display=s?"none":"";b.displayContent=s;break;case"radio":case"check":var l=b.itemInputs;for(var d=0;d<g.itemInputs.length;d++){var h=g.itemInputs[d];if(!h.value||h.type!="checkbox"){k++;continue;}var i=parseInt(h.value)-1+k;if(l[i].parentNode){l[i].parentNode.style.display=h.checked?"":"none";}if(h.checked){s=true;}}a.style.display=s?"none":"";b.displayContent=s;break;}}}var curMatrixItem=null;function divMatrixItemClick(){if(curMatrixItem==this){return;}if(curMatrixItem!=null){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";if(curMatrixItem.daoZhi){itemInputs=curMatrixItem.itemInputs;for(var a=0;a<itemInputs.length;a++){itemInputs[a].parentNode.style.background="";}}}curMatrixItem=this;this.prevBackColor=this.style.backgroundColor?"#EFF6FB":"";this.style.background="#fbd5b5";}function divQuestionClick(){if(curdiv==this){return;}if(curdiv!=null){curdiv.style.background="";}if(curdiv&&curdiv.uploadFrame){curdiv.uploadFrame.style.backgroundColor="";}hasSaveChanged=true;showLeftBar();curdiv=this;if(this.uploadFrame){this.uploadFrame.style.backgroundColor="#dff7ff";}if(curMatrixItem!=null&&curMatrixItem.parent!=curdiv){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";}this.style.background="#dff7ff";if(this.removeError){this.removeError();}if(!completeLoaded){this.style.background="";curdiv=null;}if(this.itemTextarea&&curdiv.parentNode&&curdiv.parentNode.style.display!="none"){this.itemTextarea.focus();}}function showLeftBar(){if(window.divLeftBar&&!hasDisplayed){if(window.isRunning=="true"){if(divProgressImg){divProgressImg.style.visibility="visible";}if(divSave){divSave.parentNode.style.visibility="visible";divSave.parentNode.style.marginTop="5px";}hasDisplayed=true;divLeftBar.style.background="#ffffff";}}}var loadcss=null;var loadprogress=null;function updateProgressBar(b){var a=b._topic;if(a>MaxTopic){MaxTopic=a;}if(!progressArray[a]){joinedTopic++;progressArray[a]=true;showProgressBar();}}function showProgressBar(){if(window.divProgressImg){if(!loadcss){loadcss=$("loadcss");}if(!loadprogress){loadprogress=$("loadprogress");}var c=totalQ;var d=joinedTopic;if(progressBarType==2){c=totalPage;d=cur_page+1;}var b=parseFloat(d)/c*100;b=b||0;var a=b+"%";loadcss.style.height=a;if(progressBarType==1){loadprogress.innerHTML=b.toFixed(0)+"%";}else{loadprogress.innerHTML=d+"/"+c+" "+page_info;}if(hrefSave){if(spanSave){clearInterval(saveInterval);if(divProgressImg){divProgressImg.style.paddingLeft="15px";}}}}}function itemSortClick(){var b=this.getAttribute("rel");if(b){var e=$(b);var c=e.selectedIndex;var a=e.options.length;if(this.name=="up"&&c>0){var d=e.options[c];var f=e.options[c-1];e.insertBefore(d,f);}else{if(this.name=="first"&&c>0){var d=e.options[c];var f=e.options[0];e.insertBefore(d,f);}else{if(this.name=="down"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[c+1];e.insertBefore(g,d);}else{if(this.name=="last"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[a-1];e.insertBefore(d,g);e.insertBefore(g,d);}}}}}}function itemClick(){var g=this.parent.parent||this.parent;if(g.isTrap){return;}var n=g.dataNode;updateProgressBar(n);if(this.itemText&&this.itemText.onclick){if(this.checked){this.itemText.onclick();}else{if(this.itemText.onblur){this.itemText.onblur();}}}if(this.type=="checkbox"){var o=this.getAttribute("rel");if(o){var d=$(o);var q=d.options;if(this.checked){var c=this.nextSibling.nodeValue||this.nextSibling.innerHTML;if(!c&&this.nextSibling.nextSibling){c=this.nextSibling.nextSibling.innerHTML;}d.options[q.length]=new Option(c,this.value);}else{for(var e=0;e<q.length;e++){if(q[e].value==this.value){q[e]=null;}}}}if(n._referedTopics){createItem(g);}displayRelationRaidoCheck(g,n);if(langVer==0&&(n._maxValue>0||n._minValue>0)){var q=g.itemInputs;var f=0;for(var b=0;b<q.length;b++){if(q[b].checked){f++;}}if(!g.divChecktip){g.divChecktip=document.createElement("div");g.appendChild(g.divChecktip);g.divChecktip.style.color="666";}var a="&nbsp;&nbsp;&nbsp;您已经选择了"+f+"项";if(n._maxValue>0&&f>n._maxValue){a+=",<span style='color:red;'>多选择了"+(f-n._maxValue)+"项</span>";}else{if(n._minValue>0&&f<n._minValue){a+=",<span style='color:red;'>少选择了"+(n._minValue-f)+"项</span>";}}g.divChecktip.innerHTML=a;}jump(g,this);}else{if(this.type=="radio"||n._type=="slider"||(n._type=="matrix"&&n._mode!="201")){if(!n._requir&&!g.hasClearHref){addClearHref(g);}displayRelationRaidoCheck(g,n);jump(g,this);}else{if(n._type=="matrix"&&n._mode=="201"){var l=g.itemTrs;var h=0;var p;for(var e=0;e<l.length;e++){h=validateMatrix(n,l[e],l[e].itemInputs[0]);if(h&&!p){p=l[e].itemInputs[0];break;}}if(g.removeError){g.removeError();}if(p){g.errorControl=p;validate_ok=writeError(g,verifyMsg,3000);}var m=false;for(var e=0;e<l.length;e++){var k=l[e].itemInputs[0];if(trim(k.value)!=""){m=true;break;}}jumpAny(m,g);}else{if(n._type=="sum"){if(this.parent.sliderImage){sumClick(g,this.parent.sliderImage.sliderValue);}else{sumClick(g,this);}}else{if(this.type=="text"){if(this.choiceRel){if(this.value==defaultOtherText){this.value="";}this.choiceRel.checked=true;this.style.color="#000000";if(n._referedTopics){createItem(g);}displayRelationRaidoCheck(g,n);jump(g,this.choiceRel);}}else{if(this.nodeName=="SELECT"){g.focus();jump(g,this);displayRelationDropDown(g,n);}}}}}}}function relationJoin(b){if(b.style.display!="none"){var c=b.dataNode;var a=c._type;if(a=="radio"||a=="check"){displayRelationRaidoCheck(b,c);}else{if(a=="radio_down"){displayRelationDropDown(b,c);}}}}function displayRelationRaidoCheck(d,e){var b=e._topic;if(!relationQs[b]){return;}d.hasDisplayByRelation=new Object();for(var a=0;a<d.itemInputs.length;a++){var c=false;var f=d.itemInputs[a].value;var g=b+","+f;if(d.itemInputs[a].checked){c=true;}displayByRelation(d,g,c);}}function displayRelationDropDown(f,h){var c=h._topic;if(!relationQs[c]){return;}var i=f.itemSel;var g=f.itemSel.value;f.hasDisplayByRelation=new Object();for(var d=0;d<i.length;d++){var b=false;var a=i[d].value;var e=c+","+a;if(a==g){b=true;}displayByRelation(f,e,b);}}function displayByRelation(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){if(c.hasDisplayByRelation[d[a].dataNode._topic]){continue;}if(!b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(b){d[a].style.display="";var e=d[a].dataNode._topic;c.hasDisplayByRelation[e]="1";if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function loopHideRelation(a){var c=a.dataNode._topic;var b=relationQs[c];if(b){for(var d=0;d<b.length;d++){loopHideRelation(b[d],false);}}clearAllOption(a);a.style.display="none";if(relationNotDisplayQ[c]==""){relationNotDisplayQ[c]="1";}}function sumClick(k,e,f){var r=k.getElementsByTagName("input");var s=k.dataNode;updateProgressBar(s);if(r){var h=r.length;var n=s._total;var c=n;var q=0;var m;var o;var b=e.value;if(parseInt(b)<0){e.value="";}for(var d=0;d<h;d++){var p=r[d].value;var l=k.itemTrs[d];var g=l.sliderImage;if(p&&trim(p)){if(isInt(p)){c=c-parseInt(p);if(g._value==undefined||g._value==0){g.setValue(parseInt(b),true);}else{if(f&&r[d]==e){g.setValue(parseInt(b),true);}}}else{r[d].value="";m=r[d];o=g;q++;}}else{if(l.style.display=="none"){}else{m=r[d];o=g;q++;}}}if(q==1){if(c>0){o.setValue(c,true);m.value=c;c=0;}}k.sumLeft=c;var a="";if(q==0&&c!=0){a="<br/><span style='color:red;'>"+sum_warn+"</span>";}if(k.relSum){k.relSum.innerHTML=sum_total+"<b>"+n+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+c+"</span>"+a;}jump(k,this);}}function jump(b,e){var c=b.dataNode;var a=c._anytimejumpto;var d=c._hasjump;if(d){if(a>0){jumpAnyChoice(b);}else{if(a==0&&c._type!="radio"&&c._type!="radio_down"){jumpAnyChoice(b);}else{jumpByChoice(b,e);}}}}function jumpAnyChoice(d,e){var a=d.itemInputs||d.itemLis||d.itemTrs||d.gapFills;var c=false;if(a){for(var b=0;b<a.length;b++){if(a[b].checked){c=true;}else{if(a[b].className.indexOf("on")>-1){c=true;}else{if(a[b].divSlider&&a[b].divSlider.value){c=true;}else{if(a[b].tagName=="TEXTAREA"&&trim(a[b].value)!=""){c=true;}else{if(a[b].type=="text"&&trim(a[b].value)!=""){c=true;}else{if(a[b].itemSels){for(var f=0;f<a[b].itemSels.length;f++){if(a[b].itemSels[f]){c=true;break;}}}}}}}}if(c){break;}}}else{if(d.itemSel){if(d.itemSel.selectedIndex>0){c=true;}else{c=false;}}else{if(d.divSlider){c=(d.divSlider.value!=undefined&&d.divSlider.value!=null)?true:false;}else{if(d.itemTextarea){c=trim(d.itemTextarea.value)!="";}else{if(d.uploadFrame){c=d.fileName?true:false;}}}}}jumpAny(c,d,e);}function jumpByChoice(b,d){var c=b.dataNode;if(d.value=="-2"){processJ(b.indexInPage-0,0,b.jumpInfo);}else{if(d.value=="-1"||d.value==""){processJ(b.indexInPage-0,0,b.jumpInfo);}else{if((c._type=="radio"||c._type=="radio_down")&&parseInt(d.value)==d.value){var a=c._select[d.value-1]._item_jump;processJ(b.indexInPage-0,a-0,b.jumpInfo);}}}}function txtChange(c,l){var e=c.parent.parent||c.parent;updateProgressBar(e.dataNode);hasSaveChanged=true;if(e.removeError){e.removeError();}if((e.dataNode._needOnly||(e.dataNode._hasList&&e.dataNode._listId!=-1))&&trim(c.value)!=""&&l){var a=getXmlHttp();a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){if(unescape(a.responseText)=="false1"){c.isOnly=false;writeError(e,validate_only,3000);}else{if(unescape(a.responseText)=="false2"){c.isInList=false;c.isOnly=true;writeError(e,validate_list,3000);}else{c.isInList=true;c.isOnly=true;}}}else{c.isOnly=true;c.isInList=true;}}};var n=e.dataNode._needOnly;var i=e.dataNode._hasList&&e.dataNode._listId!=-1;var d=e.dataNode._listId;a.open("get","/Handler/AnswerOnlyHandler.ashx?q="+activityId+"&at="+escape(c.value)+"&qI="+e.dataNode._topic+"&o="+n+"&l="+i+"&lid="+d+"&t="+(new Date()).valueOf());a.send(null);}var h=e.dataNode._verify;if(c.value!=""&&h&&h!="0"){if(e.removeError){e.removeError();}var k=e.dataNode;var m=e.getAttribute("issample");var g=true;if(jiFen>0&&m&&promoteSource!="t"){g=false;}if(g){var b=verifyMinMax(c.value,h,k._minword,k._maxword);if(b!=""){validate_ok=writeError(e,b,3000);}b=verifydata(c.value,h,e.dataNode);if(b!=""){validate_ok=writeError(e,b,3000);}}}if(e.dataNode._type=="gapfill"){var f=0;f=validateMatrix(e.dataNode,c,c);if(f){e.errorControl=c;writeError(e,verifyMsg,3000);}}if(e.dataNode._type=="sum"){sumClick(e,c,1);}else{jumpAny(trim(c.value)!="",e);}}function jumpAny(a,b,d){var c=b.dataNode;if(c._hasjump){if(a){processJ(b.indexInPage-0,c._anytimejumpto-0,b.jumpInfo,d);}else{processJ(b.indexInPage-0,0,b.jumpInfo,d);b.jumpInfo.innerHTML="<font color='#666666'>*"+jump_info+"</font>";}}}function processJ(o,c,l,d){var a=o+1;var b=cur_page;for(var g=cur_page;g<pageHolder.length;g++){var m=pageHolder[g].questions;if(c==1){b=g;}for(var f=a;f<m.length;f++){var h=m[f].dataNode._topic;if(h==c||c==1){b=g;}if(h<c||c==1){m[f].style.display="none";if(!progressArray[h]){joinedTopic++;progressArray[h]="jump";}}else{if(relationNotDisplayQ[h]){var e=1;}else{m[f].style.display="";}if(progressArray[h]=="jump"){joinedTopic--;progressArray[h]=false;}if(m[f].dataNode._hasjump&&!d){clearAllOption(m[f]);if(m[f].jumpInfo){m[f].jumpInfo.innerHTML="<font color='#0066ff'>*"+jump_info+"</font>";}}}}a=0;}l.innerHTML="";var n=b-cur_page-1;jumpPages=new Array();for(var k=0;k<n;k++){jumpPages[k]=cur_page+k+1;}showProgressBar();}function addClearHref(b){var c=b.dataNode;var a=document.createElement("a");a.title=validate_info_submit_title2;a.className="link-999";a.style.marginLeft="25px";a.innerHTML="["+type_radio_clear+"]";a.href="javascript:void(0);";b.hasClearHref=true;b.divTitle.appendChild(a);b.clearHref=a;a.onclick=function(){clearAllOption(b);jumpAny(false,b);};}function clearAllOption(d){var e=d.itemSel;if(e){e.selectedIndex=0;}if(d.divSlider&&d.divSlider.value!=undefined){d.sliderImage.setValue(d.dataNode._minvalue,true);d.divSlider.value=undefined;}var a=d.itemInputs||d.itemLis||d.itemTrs;if(!a){return;}d.hasClearHref=false;if(d.clearHref){d.clearHref.parentNode.removeChild(d.clearHref);d.clearHref=null;}for(var c=0;c<a.length;c++){if(a[c].checked){a[c].checked=false;}else{if(a[c].className.toLowerCase().indexOf("on")>-1){a[c].className="off"+d.dataNode._mode;}else{if(a[c].parent&&a[c].parent.holder){a[c].parent.holder=0;}else{if(a[c].divSlider&&a[c].divSlider.value){a[c].sliderImage.setValue(d.dataNode._minvalue,true);a[c].divSlider.value=undefined;}else{var f=a[c].itemInputs||a[c].itemLis;if(f){for(var b=0;b<f.length;b++){if(f[b].checked){f[b].checked=false;}else{if(f[b].className.toLowerCase().indexOf("on")>-1){f[b].className="off"+d.dataNode._mode;}else{if(f[b].parent&&f[b].parent.holder){f[b].parent.holder=0;}}}}}}}}}}if(d.holder){d.holder=0;}}function itemMouseOver(){var c=this.parent.parent||this.parent;if(c.dataNode.isRate){var a=this.parent.itemLis.length;var d="on";for(var b=0;b<a;b++){d=b<this.value?"on":"off";this.parent.itemLis[b].className=d+c.dataNode._mode;}}}function itemMouseOut(){var d=this.parent.parent||this.parent;if(d.dataNode.isRate){var a=this.parent.itemLis.length;var e="on";var c=this.parent.holder||0;for(var b=0;b<a;b++){e=b<c?"on":"off";this.parent.itemLis[b].className=e+d.dataNode._mode;}}}function itemLiClick(){var b=this.parent.parent||this.parent;var c=b.dataNode;updateProgressBar(c);if(c.isRate){this.parent.holder=this.value;for(var a=0;a<this.value;a++){this.parent.itemLis[a].className="on"+c._mode;}if(!c._requir&&!b.hasClearHref){addClearHref(b);}jump(b,this);}}function set_data_fromServer(c){var l=new Array();l=c.split("¤");var g=l[0];var a=g.split("§");hasTouPiao=a[0]=="true";useSelfTopic=a[1]=="true";var p=0;var m=0;var k=true;var o=0;for(var h=1;h<l.length;h++){var e=new Object();var d=l[h].split("§");switch(d[0]){case"page":if(k){k=false;}else{m++;}o=0;if(d[2]=="true"){pageHolder[m]._iszhenbie=true;}pageHolder[m]._mintime=d[3]?parseInt(d[3]):"";pageHolder[m]._maxtime=d[4]?parseInt(d[4]):"";break;case"question":e._type=trim(d[0]);e._topic=trim(d[1]);e._height=trim(d[2]);e._maxword=trim(d[3]);if(d[4]=="true"){e._requir=true;}else{e._requir=false;}if(d[5]=="true"){e._norepeat=true;}else{e._norepeat=false;}if(trim(d[6])=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=trim(d[7]);e._verify=trim(d[8]);e._needOnly=d[9]=="true"?true:false;e._hasList=d[10]=="true"?true:false;e._listId=d[11]?parseInt(d[11]):-1;e._minword=d[12];pageHolder[m].questions[o].dataNode=e;o++;break;case"slider":e._type=trim(d[0]);e._topic=trim(d[1]);if(d[2]=="true"){e._requir=true;}else{e._requir=false;}e._minvalue=trim(d[3]);e._maxvalue=trim(d[4]);if(trim(d[5])=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=trim(d[6]);pageHolder[m].questions[o].dataNode=e;o++;break;case"fileupload":e._type=trim(d[0]);e._topic=trim(d[1]);if(d[2]=="true"){e._requir=true;}else{e._requir=false;}e._maxsize=trim(d[3]);e._ext=trim(d[4]);if(trim(d[5])=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=trim(d[6]);pageHolder[m].questions[o].dataNode=e;o++;break;case"gapfill":e._type=trim(d[0]);e._topic=trim(d[1]);if(d[2]=="true"){e._requir=true;}else{e._requir=false;}e._gapcount=trim(d[3]);if(trim(d[4])=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=trim(d[5]);pageHolder[m].questions[o].dataNode=e;o++;break;case"sum":e._type=trim(d[0]);e._topic=trim(d[1]);if(d[2]=="true"){e._requir=true;}else{e._requir=false;}e._total=parseInt(d[3]);if(trim(d[4])=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=trim(d[5]);e._referTopic=d[6];pageHolder[m].questions[o].dataNode=e;o++;break;case"radio":case"check":case"radio_down":case"matrix":e._type=trim(d[0]);e._topic=trim(d[1]);e._numperrow=trim(d[2]);if(d[3]=="true"){e._hasvalue=true;}else{e._hasvalue=false;}if(d[4]=="true"){e._hasjump=true;}else{e._hasjump=false;}e._anytimejumpto=d[5];e._mode=trim(d[9]);if(d[0]!="check"){if(d[6]=="true"){e._requir=true;}else{e._requir=false;}e.isSort=false;e.isRate=isRadioRate(e._mode);}else{var n=d[6].split(",");e._minValue=0;e._maxValue=0;if(n[0]=="true"){e._requir=true;}else{e._requir=false;}if(n[1]!=""){e._minValue=Number(n[1]);}if(n[2]!=""){e._maxValue=Number(n[2]);}e.isSort=e._mode!=""&&e._mode!="0";e.isRate=false;}if(d[7]=="true"){e._isTouPiao=true;}else{e._isTouPiao=false;}e._verify=trim(d[8]);e._referTopic=d[10];e._referedTopics=d[11];var b=12;e._select=new Array();for(var f=b;f<d.length;f++){e._select[f-b]=new Object();if(d[f].split("〒")[0]=="true"){e._select[f-b]._item_radio=true;}else{e._select[f-b]._item_radio=false;}e._select[f-b]._item_value=trim(d[f].split("〒")[1]);e._select[f-b]._item_jump=trim(d[f].split("〒")[2]);}pageHolder[m].questions[o].dataNode=e;o++;break;default:break;}}}function show_pre_page(){if(cur_page>0&&pageHolder[cur_page-1].hasExceedTime){alert("上一页填写超时，不能返回上一页");return;}submit_table.style.display="none";next_page.style.display="";pageHolder[cur_page].style.display="none";cur_page--;if(jumpPages){var c=jumpPages.length;if(c>0){if(cur_page==jumpPages[c-1]){for(var b=c-1;b>=0;b--){if(cur_page==jumpPages[b]){cur_page--;}}}}}for(var d=cur_page;d>=0;d--){if(pageHolder[d].skipPage){cur_page--;}else{break;}}if(cur_page==0&&pre_page){pre_page.style.display=displayPrevPage;pre_page.disabled=true;}pageHolder[cur_page].style.display="";var a=pageHolder[cur_page].questions;pageHolder[cur_page].scrollIntoView();if(window.parent&&window.parent.adjustMyFrameHeight){window.parent.adjustMyFrameHeight();}}var pubNoCheck=null;var saveNeedAlert=true;function show_next_page(a){next_page.disabled=true;if(pubNoCheck!=true){if(isPreview){submit_button.onclick=function(){alert("此为预览状态，不能提交答卷！");};to_next_page();return;}else{if(a!=true&&!validate()){if(isPub&&pubNoCheck==null){if(window.confirm("您填写的数据不符合要求，由于您是发布者，可以选择直接跳到下一页（此次填写的答卷将不能提交），是否确定？")){pubNoCheck=true;$("submittest_button").onclick=submit_button.onclick=function(){alert("由于您选择了跳过了数据检查，所以此次填写的答卷无法提交！如果您需要提交答卷，请刷新此页面并再次填写问卷。");};to_next_page();return;}else{pubNoCheck=false;next_page.disabled=false;return;}}else{next_page.disabled=false;return;}}}}else{if(pubNoCheck==true){to_next_page();return;}}if(pageHolder[cur_page]._iszhenbie&&isRunning=="true"){submit(3);}else{to_next_page();if(a!=true&&allowSaveJoin&&isRunning=="true"&&guid){saveNeedAlert=false;submit(2);}}}function to_next_page(){if(cur_page==0&&nextPageAlertText){alert(nextPageAlertText);}pre_page.style.display=displayPrevPage;pre_page.disabled=false;pageHolder[cur_page].style.display="none";cur_page++;next_page.disabled=false;if(jumpPages){var b=jumpPages.length;if(b>0){if(cur_page==jumpPages[0]){for(var a=0;a<b;a++){if(cur_page==jumpPages[a]){cur_page++;}}}}}for(var c=cur_page;c<pageHolder.length;c++){if(pageHolder[c].skipPage){cur_page++;}else{break;}}var d=true;for(var c=cur_page+1;c<pageHolder.length;c++){if(!pageHolder[c].skipPage){d=false;}}if(cur_page>=pageHolder.length-1||d){next_page.style.display="none";if(hasJoin!="1"){submit_table.style.display="";}}if(divMaxTime){divMaxTime.style.display="none";}pageHolder[cur_page].style.display="";pageHolder[cur_page].scrollIntoView();showProgressBar();processMinMax();if(window.parent&&window.parent.adjustMyFrameHeight){window.parent.adjustMyFrameHeight();}}if(hrefPreview){hrefPreview.onclick=function(){submit(0);return false;};}var spanSave=null;var saveInterval=null;var hasSaveChanged=false;var manualSave=false;var changeInterval=null;var totalSaveSec=1;if(hrefSave){hrefSave.onclick=function(){manualSave=true;submit(2);manualSave=false;return false;};saveInterval=setInterval(function(){submit(2);},60000);}var havereturn=false;var timeoutTimer=null;function ontimeout(){if(!havereturn){havereturn=true;alert("请求超时，可能是由于您的网速过慢，请稍候重试！");refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";}if(timeoutTimer){clearTimeout(timeoutTimer);}}var currentAnswer="";var errorTimes=0;function submit(m){if(m!=2&&!validate()){return;}if(tCode&&tCode.style.display!="none"&&m==1){var n=true;if(submit_text.value==""||submit_text.value==validate_info_submit_title3){alert(validate_info_submit1);n=false;}else{if(needAvoidCrack==1&&!yucVerify){alert("验证码输入错误");n=false;}}if(!n){try{submit_text.focus();submit_text.click();}catch(l){}return false;}}submit_tip.innerHTML=validate_info_submit2;if(m==0){PromoteUser("正在处理，请稍候...",3000,true);}else{if(m==2){if(!hasSaveChanged){if(manualSave){if(spanSave){spanSave.innerHTML="&nbsp;已保存";}else{PromoteUser("已保存",3000,true);}submit_tip.scrollIntoView();}return;}if(spanSave){spanSave.innerHTML="&nbsp;正在保存，请稍候...";}var h=cur_page;}else{if(m==3){PromoteUser("正在验证，请稍候...",3000,true);}else{submit_tip.style.display="block";submit_div.style.display="none";}}}needCheckLeave=false;var o=sent_to_answer();var c=getXmlHttp();c.onreadystatechange=function(){if(c.readyState==4){havereturn=true;clearTimeout(timeoutTimer);if(c.status==200){afterSubmit(c.responseText,m);}else{currentAnswer=o;errorTimes++;PDF_launch("/wjx/join/jqerror.aspx?activityid="+activityId+"&status="+c.status+"&et="+errorTimes,400,120);refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";}}};var p="/wjx/join/processjq.aspx?submittype="+m+"&curID="+activityId+"&source="+encodeURIComponent(source)+"&cp="+encodeURIComponent(cProvince)+"&cc="+encodeURIComponent(cCity)+"&ci="+escape(cIp)+"&t="+(new Date()).valueOf();if(refu){p+="&refu="+encodeURIComponent(refu);}if(hasTouPiao){p+="&toupiao=t";}if(jiFen>0){p+="&jf="+jiFen;}if(randomparm){p+="&ranparm="+randomparm;}if(qinvited){p+="&qinvited="+qinvited;}if(inviteid){p+="&inviteid="+inviteid;}if(eproguid){p+="&eproguid="+eproguid;}if(parterid){p+="&partnerid="+parterid;}if(m==2){p+="&lastpage="+h+"&lastq="+MaxTopic;}if(m==3){p+="&zbp="+(cur_page+1);}if(hasJoin){p+="&nfjoinid="+nfjoinid;}if(Request("sojumpparm")){p+="&sojumpparm="+Request("sojumpparm");}if(tCode&&submit_text.value!=""){p+="&validate_text="+encodeURIComponent(submit_text.value);}p+="&starttime="+encodeURIComponent(starttime);if(guid){p+="&guid="+guid;}if(window.sjUser){p+="&sjUser="+encodeURIComponent(sjUser);}if(window.mobileRnum){p+="&m="+window.mobileRnum;}if(Password){p+="&psd="+encodeURIComponent(Password);}if(sourceDetail){p+="&sd="+sourceDetail;}if(window.parterparm&&window.parterparmname){p+="&"+parterparmname+"="+parterparm;}if(wbid){p+="&wbid="+wbid;}if($("BMserialnum")){p+="&BMserialnum="+encodeURIComponent($("BMserialnum").value);}o=o.replace(/\+/g,"%2B");var b=encodeURIComponent(o);var a=false;var g="";var k="";for(var e=0;e<trapHolder.length;e++){g="";var q=trapHolder[e].itemInputs;for(var f=0;f<q.length;f++){if(q[f].checked){g+=q[f].value+",";}}var d=trapHolder[e].getAttribute("trapanswer");if(g&&d&&g.indexOf(d)==-1){a=true;k=trapHolder[e].getAttribute("tikuindex");break;}}if(a){p+="&ite=1&ics="+encodeURIComponent(k+";"+g);}var i=false;if(i){p+="&submitdata="+b;}c.open("post",p);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");havereturn=false;timeoutTimer=setTimeout(ontimeout,20000);if(i){c.send(null);}else{c.send("submitdata="+b);}}function getExpDate(d,a,c){var b=new Date();if(typeof(d)=="number"&&typeof(a)=="number"&&typeof(a)=="number"){b.setDate(b.getDate()+parseInt(d));b.setHours(b.getHours()+parseInt(a));b.setMinutes(b.getMinutes()+parseInt(c));return b.toGMTString();}}function afterSubmit(w,l){var o=w.split("〒");var k=o[0];if(l==0){if(k==14){var b=o[1];window.open("/wjx/previewanswer.aspx?activityid="+activityId+"&sg="+b+"&t="+(new Date()).valueOf());}else{alert("请点击预览答卷按钮");}}else{if(l==2){if(k==14){var b=o[1];var h=window.location.href.toLowerCase();if(h.indexOf("?")>-1){if(h.indexOf("sg=")>-1){h=h.replace(/sg=([\w|\-]+)/g,"sg="+b);}else{h=h+"&sg="+b;}}else{h=h+"?sg="+b;}if(hrefSave){var r=getTop(hrefSave);if(!spanSave){spanSave=document.createElement("div");divSaveText.appendChild(spanSave);spanSave.style.color="#666666";spanSave.style.lineHeight="14px";spanSave.style.marginTop="17px";spanSave.style.width="14px";if(divProgressImg){divProgressImg.style.paddingLeft="7px";}else{spanSave.style.paddingLeft="15px";}}var u=new Date();var p=u.getMinutes();if(p<10){p="0"+p;}var c=u.getHours();if(c<10){c="0"+c;}var d=c+":"+p;spanSave.innerHTML="答卷保存于<div id='saveData'>1</div><div id='divUnit'>秒</div>钟前";if(divLeftBar){divLeftBar.title="下次可以接着继续填写";}totalSaveSec=1;spanSave.style.display="";submit_tip.style.display="none";clearInterval(changeInterval);changeInterval=setInterval(function(){var e=$("saveData");if(e){totalSaveSec++;e.innerHTML=totalSaveSec;if(totalSaveSec>60){e.innerHTML=parseInt(totalSaveSec/60);$("divUnit").innerHTML="分";}}},1000);}hasSaveChanged=false;clearInterval(saveInterval);saveInterval=setInterval(function(){submit(2);},60000);if(!guid){var m=window.location.host||"sojump.com";try{setCookie(activityId+"_save",b,getExpDate(2,0,0),"/",m,null);}catch(t){}}if(o[2]){nfjoinid=o[2];hasJoin="2";}if(o[3]){starttime=o[3];}return;}}else{if(l==3){if(k==12){randomparm=o[1];PromoteUser("",1,true);to_next_page();return;}else{if(k==13){var g=o[1];var x=o[2]||"0";var h="/wjx/join/complete.aspx?q="+activityId+"&s="+simple+"&joinid="+g;if(guid){h+="&guid="+guid;}if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}h+="&v="+x;if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}location.replace(h);return;}}}else{if(k==10){var h=o[1];h+="&s="+simple;if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}if(qwidth){h+="&width="+qwidth;}if(qinvited){h+="&qinvited="+qinvited;}if(inviteid){h+="&inviteid="+inviteid;}if(parterid){h+="&partnerid="+parterid;}if(source){h+="&source="+encodeURIComponent(source);}if(guid){h+="&guid="+guid;}if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}if(window.parterparm&&window.parterparmname){h+="&"+parterparmname+"="+parterparm;}if(window.needJQJiang){h+="&njqj=1";}var m=window.location.host||"sojump.com";try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/",m,null);}catch(t){}location.replace(h);return;}else{if(k==11){var n=o[1];if(!n){n=window.location.href;}else{if(n.toLowerCase().indexOf("http://")==-1&&n.toLowerCase().indexOf("https://")==-1){n="http://"+n;}}var y=o[3]||"";if(Request("sojumpparm")){n=n.replace("{output}",Request("sojumpparm"));}var a="sojumpindex="+y;if(n.indexOf("?")>-1){a="&"+a;}else{a="?"+a;}if(n.toLowerCase().indexOf("sojumpparm=")==-1){a+="&sojumpparm="+Request("sojumpparm");}n+=a;var v=o[2];if(v&&v!="不提示"){alert(v);}var m=window.location.host||"sojump.com";try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/",m,null);}catch(t){}location.replace(n);return;}else{if(k==9||k==16){var q=parseInt(o[1]);var f=(q+1)+"";if(pageHolder.length==1){writeError(pageHolder[0].questions[q],o[2],3000);}else{if(questionsObject[f]){writeError(questionsObject[f],o[2],3000);}else{alert("您提交的数据有误，请检查！");}}}else{if(k==7){alert(o[1]);if(needAvoidCrack!=2){tCode.style.display="";submit_tip.style.display="none";submit_div.style.display="block";try{submit_text.focus();submit_text.click();}catch(s){}}}else{if(k==2){alert(o[1]);}else{if(k==17){alert("密码冲突！在您提交答卷之前，此密码已经被另外一个用户使用了，请重新更换密码！\r\n系统会自动保存您当前填写的答卷，请复制新的链接重新提交此份答卷！");submit(2);return;}else{if(k==4){alert(o[1]);submit(2);return;}else{if(k==19){alert(o[1]);window.location="/";return;}else{alert(o[1]);}}}}}}}}}}}refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";return;}var firstError=null;var firstMatrixError=null;function sent_to_answer(){var l=new Array();var p=0;for(var m=0;m<pageHolder.length;m++){var N=pageHolder[m].questions;var h=pageHolder[m]._maxtime>0;for(var M=0;M<N.length;M++){var x=N[M].dataNode;var f=N[M].style.display.toLowerCase()=="none"||(N[M].dataNode._referTopic&&!N[M].displayContent)||pageHolder[m].skipPage;var g=new Object();g._topic=x._topic;g._value="";l[p++]=g;switch(x._type){case"question":if(f){g._value="(跳过)";continue;}var F=N[M].itemTextarea||N[M].itemInputs[0];var q=F.value||"";g._value=replace_specialChar(q);break;case"gapfill":var a=N[M].gapFills;for(var I=0;I<a.length;I++){if(I>0){g._value+="〒";}if(f){g._value+="(跳过)";}else{g._value+=replace_specialChar(trim(a[I].value.substring(0,3000)));}}break;case"slider":var G=N[M].divSlider.value;if(f){g._value="(跳过)";continue;}g._value=G==undefined?"":G;break;case"fileupload":var u=N[M].fileName;if(f){g._value="(跳过)";continue;}g._value=u||"";break;case"sum":var n=N[M].itemInputs;len=n.length;for(var I=0;I<len;I++){var C=n[I];var D=N[M].relSum==0?trim(C.value)||"0":trim(C.value);if(I>0){g._value+="〒"+D;}else{g._value=D;}}if(f){var H=0;while(H<len){if(H==0){g._value="(跳过)";}else{g._value+="〒(跳过)";}H++;}}break;case"radio":case"check":if(N[M].itemSel){var O=N[M].itemSel;var s=O.options;if(f){var H=0;while(H<x._select.length){if(H==0){g._value="-3";}else{g._value+=",-3";}H++;}continue;}for(var I=0;I<s.length;I++){if(I==0){g._value=s[I].value+"";}else{g._value+=","+s[I].value;}}if(s.length==0||s.length<x._select.length){var B=x._select.length;for(var I=s.length;I<B;I++){if(g._value){g._value+=",-2";}else{g._value="-2";}}}continue;}if(f){g._value="-3";continue;}var s=N[M].itemInputs||N[M].itemLis;var o=-1;var E=0;for(var I=0;I<s.length;I++){if(s[I].className.toLowerCase().indexOf("on")>-1){o=I;}var r=s[I].parentNode&&s[I].parentNode.style.display=="none";if(!r&&s[I].checked){E++;if(g._value){g._value+="┋"+s[I].value;}else{g._value=s[I].value+"";}if(s[I].itemText){var J=s[I].itemText.value;if(J==defaultOtherText){J="";}g._value+="〒"+replace_specialChar(trim(J.substring(0,3000)));}}}if(o>-1){g._value=s[o].value+"";}else{if(E>0){}else{g._value="-2";}}break;case"radio_down":if(f){g._value="-3";continue;}g._value=N[M].itemSel.value;break;case"matrix":var c=N[M].itemTrs;var d=x._mode;len=c.length;var P=0;var e=0;var z=0;for(var I=0;I<c.length;I++){if(c[I].style.display=="none"){if(d!="201"&&d!="202"){if(g._value){g._value+=",-2";}else{g._value="-2";}continue;}}var s=c[I].itemInputs||c[I].itemLis||c[I].divSlider||c[I].itemSels;if(!s){len=len-1;continue;}else{P=s.length;}var o=-1;var A="";if(d!="201"&&d!="202"){for(var H=0;H<s.length;H++){if(s[H].className.toLowerCase().indexOf("on")>-1){o=H;A=s[H].value;}if(s[H].checked){o=H;if(A){A+=";"+s[H].value;}else{A=s[H].value;}}else{if(s[H].tagName=="TEXTAREA"||s[H].tagName=="SELECT"){o=H;var L=trim(s[H].value);if(H>0){A+="┋";}if(L){if(d=="302"){L=replace_specialChar(L);}A+=L;}else{A+="(空)";}}}}if(o>-1){if(g._value){if(d=="301"||d=="302"||d=="303"){g._value+="〒"+A;}else{g._value+=","+A;}}else{g._value=A;}}else{if(g._value){g._value+=",-2";}else{g._value="-2";}}}else{if(d=="201"){var w=trim(s[0].value.substring(0,3000));if(c[I].style.display=="none"){w="";}if(z>0){g._value+="〒"+replace_specialChar(w);}else{g._value=replace_specialChar(w);}}else{if(d=="202"){var K=c[I].divSlider.value==undefined?"":c[I].divSlider.value;if(c[I].style.display=="none"){K="";}if(z>0){g._value+="〒"+K;}else{g._value=K;}}}}z++;}if(f){var H=0;g._value="";while(H<len){if(d=="201"||d=="202"){if(H==0){g._value="(跳过)";}else{g._value+="〒(跳过)";}}else{if(d=="301"||d=="302"||d=="303"){if(H>0){g._value+="〒";}for(var y=0;y<P;y++){if(y>0){g._value+="┋";}if(d=="303"){g._value+="-3";}else{g._value+="(跳过)";}}}else{if(H==0){g._value="-3";}else{g._value+=",-3";}}}H++;}continue;}break;}}}l.sort(function(k,i){return k._topic-i._topic;});var b="";for(M=0;M<l.length;M++){if(M>0){b+="¤";}b+=l[M]._topic;b+="§";b+=l[M]._value;}return b;}var verifyMsg="";function validate(){var f=true;var a=pageHolder[cur_page].questions;var n=pageHolder[cur_page].hasExceedTime;firstError=null;firstMatrixError=null;for(var H=0;H<a.length;H++){var K=a[H].dataNode;var c=K._hasjump;verifyMsg="";var z=a[H].style.display.toLowerCase()=="none"||pageHolder[cur_page].skipPage;if(a[H].removeError){a[H].removeError();}if(z||(a[H].dataNode._referTopic&&!a[H].displayContent)||n){continue;}switch(K._type){case"question":var w=a[H].itemTextarea||a[H].itemInputs[0];var g=w.value||"";if(K._requir){if(trim(g)==""){f=writeError(a[H],validate_info+validate_info_wd1,3000);}}if(g.length-3000>0){f=writeError(a[H],"您输入的字数超过了3000，请修改！",3000);}var b=K._verify;var m=a[H].getAttribute("issample");var E=true;if(jiFen>0&&m&&promoteSource!="t"){E=false;}if(E){if(g){var l=verifyMinMax(g,b,K._minword,K._maxword);if(l!=""){f=writeError(a[H],l,3000);}}if(g!=""&&b&&b!="0"){var l=verifydata(g,b,K);if(l!=""){f=writeError(a[H],l,3000);}}}if(f&&trim(g)!=""&&isRunning=="true"){if(K._needOnly){if(w.isOnly==false){f=writeError(a[H],validate_only,3000);}else{if(w.isOnly!=true){f=writeError(a[H],validate_error,3000);w.focus();return f;}}}if(f&&K._hasList&&K._listId!=-1){if(w.isInList==false){f=writeError(a[H],validate_list,3000);}else{if(w.isInList!=true){f=writeError(a[H],validate_error,3000);w.focus();return f;}}}}if(c){jumpAnyChoice(a[H],true);}break;case"gapfill":var o=a[H].gapFills;for(var G=0;G<o.length;G++){var g=o[G].value||"";if(trim(g)==""){if(K._requir){a[H].errorControl=o[G];f=writeError(a[H],validate_info+validate_info_wd1,3000);break;}}else{var s=0;s=validateMatrix(K,o[G],o[G]);if(s){a[H].errorControl=o[G];f=writeError(a[H],verifyMsg,3000);break;}}}break;case"slider":var d=a[H].divSlider.value;if(K._requir&&d==undefined){f=writeError(a[H],validate_info+validate_info_wd1,3000);}if(c){jumpAnyChoice(a[H],true);}break;case"fileupload":if(K._requir&&!a[H].fileName){f=writeError(a[H],validate_info+validate_info_wd1,3000);}if(c){jumpAnyChoice(a[H],true);}break;case"sum":var A=a[H].sumLeft;if(K._requir){if(A!=0){f=false;if(!firstError){firstError=a[H];}var l="<br/><span style='color:red;'>"+sum_warn+"</span>";if(a[H].relSum){a[H].relSum.innerHTML=sum_total+"<b>"+K._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(A||K._total)+"</span>"+l;}}}else{if(A!=undefined&&A!=0){f=false;if(!firstError){firstError=a[H];}var l="<br/><span style='color:red;'>"+sum_warn+"</span>";if(a[H].relSum){a[H].relSum.innerHTML=sum_total+"<b>"+K._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(A||K._total)+"</span>"+l;}}}if(c){jumpAnyChoice(a[H],true);}break;case"radio":case"check":if(a[H].itemSel){var J=a[H].itemSel;var e=J.options;if(e.length==0&&K._requir){f=writeError(a[H],validate_info+validate_info_wd1,3000);}else{if(e.length>0){if((K._minValue==0||K._minValue==K._select.length)&&e.length!=K._select.length){f=writeError(a[H],validate_info+validate_info_check3,3000);}else{if(K._maxValue>0&&e.length>K._maxValue){var h=validate_info+validate_info_check1+K._maxValue+validate_info_check2;if(langVer==0){h+=",您多选择了"+(e.length-K._maxValue)+"项";}f=writeError(a[H],h,3000);}else{if(K._minValue>0&&e.length<K._minValue){var h=validate_info+validate_info_check1+K._minValue+validate_info_check2;if(langVer==0){h+=",您少选择了"+(K._minValue-e.length)+"项";}f=writeError(a[H],h,3000);}}}}}if(c){jumpAnyChoice(a[H],true);}continue;}var e=a[H].itemInputs||a[H].itemLis;var r=-1;var x=0;var C=-1;for(var G=0;G<e.length;G++){if(e[G].className.toLowerCase().indexOf("on")>-1){r=G;C=G;}if(e[G].checked){x++;C=G;if(e[G].req&&isTextBoxEmpty(e[G].itemText.value)){f=writeError(a[H],validate_textbox,3000);}}}if(r>-1){hasChoice=true;}else{if(x>0){hasChoice=true;if(K._maxValue>0&&x>K._maxValue){var h=validate_info+validate_info_check4+K._maxValue+type_check_limit5;if(langVer==0){h+=",您多选择了"+(x-K._maxValue)+"项";}f=writeError(a[H],h,3000);}else{if(K._minValue>0&&x<K._minValue){var h=validate_info+validate_info_check5+K._minValue+type_check_limit5;if(langVer==0){h+=",您少选择了"+(K._minValue-x)+"项";}f=writeError(a[H],h,3000);}}}else{if(K._requir){f=writeError(a[H],validate_info+validate_info_wd1,3000);}}}if(c){if(K._type=="radio"&&K._anytimejumpto<1){if(C>-1){processJ(a[H].indexInPage-0,K._select[e[C].value-1]._item_jump-0,a[H].jumpInfo,true);}else{processJ(a[H].indexInPage-0,0,a[H].jumpInfo,true);}}else{jumpAnyChoice(a[H],true);}}break;case"radio_down":if(K._requir&&a[H].itemSel.selectedIndex==0){f=writeError(a[H],validate_info+validate_info_wd1,3000);}if(c){if(K._anytimejumpto<1){if(a[H].itemSel.selectedIndex==0){processJ(a[H].indexInPage-0,0,a[H].jumpInfo,true);}else{processJ(a[H].indexInPage-0,K._select[a[H].itemSel.value-1]._item_jump-0,a[H].jumpInfo,true);}}else{jumpAnyChoice(a[H],true);}}break;case"matrix":var v=a[H].itemTrs;var u=K._mode;len=v.length;var y=0;var F=0;var s=0;var B;for(var G=0;G<v.length;G++){if(v[G].style.display=="none"){len=len-1;continue;}var e=v[G].itemInputs||v[G].itemLis||v[G].divSlider||v[G].itemSels;if(!e){len=len-1;continue;}var r=-1;if(u!="201"&&u!="202"){for(var D=0;D<e.length;D++){if(e[D].className.toLowerCase().indexOf("on")>-1){r=D;}else{if(e[D].checked){r=D;}else{if(e[D].tagName=="TEXTAREA"||e[D].tagName=="SELECT"){var I=trim(e[D].value);r=D;if(!I){r=-1;if(u=="301"&&K._requir){F=1;if(!B){B=e[D];}}break;}else{if(u=="301"){if(!/^(\-)?\d+(\.\d+)?$/.exec(I)){F=1;}else{if((K._minvalue&&parseInt(I)-parseInt(K._minvalue)<0)||(K._maxvalue&&parseInt(I)-parseInt(K._maxvalue)>0)){F=2;}}if(F&&!B){B=e[D];}}}}}}}}else{if(u=="201"){if(!s){s=validateMatrix(K,v[G],e[0]);}if(s&&!B){B=e[0];}if(trim(e[0].value)!=""){r=0;}}else{if(u=="202"){if(v[G].divSlider.value!=undefined){r=0;}}}}if(r>-1){y++;}else{if(K._requir){break;}}}if(K._requir&&y<len){f=writeError(a[H],validate_info+validate_info_matrix2+validate_info_matrix1+(y+1)+validate_info_matrix3,3000);if(a[H].itemTrs[G]&&!firstMatrixError){firstMatrixError=a[H].itemTrs[G];a[H].itemTrs[G].onclick();}}if(u=="201"&&s){if(B){a[H].errorControl=B;}f=writeError(a[H],verifyMsg,3000);if(a[H].itemTrs[G]&&!firstMatrixError){firstMatrixError=a[H].itemTrs[G];a[H].itemTrs[G].onclick();}}if(u=="301"&&F){var L="";if(F==2){if(K._minvalue){L+=","+type_wd_minlimitDigit+":"+K._minvalue;}if(K._maxvalue){L+=","+type_wd_maxlimitDigit+":"+K._maxvalue;}}if(a[H].itemTrs[G]&&!firstMatrixError){firstMatrixError=a[H].itemTrs[G];a[H].itemTrs[G].onclick();}if(B){a[H].errorControl=B;}f=writeError(a[H],validate_info+validate_info_matrix4+L,3000);}if(c){jumpAnyChoice(a[H],true);}break;}}for(var q=0;q<trapHolder.length;q++){if(trapHolder[q].pageIndex!=cur_page+1){continue;}var e=trapHolder[q].itemInputs;var p="";for(var G=0;G<e.length;G++){if(e[G].checked){p+=e[G].value+",";}}if(!p){f=writeError(trapHolder[q],validate_info+validate_info_wd1,3000);break;}}if(firstError){PromoteUser(validate_submit,3000,false);if(firstMatrixError&&firstMatrixError.parent==firstError){firstMatrixError.scrollIntoView();}else{firstError.scrollIntoView();}}return f;}function validateMatrix(i,b,f){var d=0;if(!f.value){return d;}var h=f.value;var a=b.getAttribute("itemverify")||"";var g=b.getAttribute("minword")||"";var c=b.getAttribute("maxword")||"";var k=b.getAttribute("issample");var e=true;verifyMsg="";if(jiFen>0&&k&&promoteSource!="t"){e=false;}if(e){verifyMsg=verifyMinMax(h,a,g,c);}if(verifyMsg!=""){d=1;}if(e&&d==0&&a&&a!="0"){verifyMsg=verifydata(h,a,i);if(verifyMsg!=""){d=2;}}return d;}function removeError(){if(this.errorMessage){try{this.removeChild(this.errorMessage);this.errorMessage=null;}catch(a){this.errorMessage.innerHTML="";}this.removeError=null;this.style.border="solid 2px white";this.style.borderBottom="solid 1px #efefef";this.style.paddingBottom="5px";if(this.errorControl){this.errorControl.style.background="white";this.errorControl=null;}}}function PromoteUser(c,b,a){show_status_tip(c,b);if(!a){alert(c);}}function writeError(b,d,c){if(b.errorMessage&&b.errorMessage.innerHTML!=""){return;}if(b.dataNode&&((b.dataNode._type=="matrix"&&b.dataNode._mode=="202")||b.dataNode._type=="slider")){}else{b.style.padding="4px";b.style.border="solid 2px #ff9900";b.style.borderBottom="solid 2px #ff9900";}if(b.errorMessage&&b.errorMessage.innerHTML==""){b.errorMessage.innerHTML=d;}else{var a=document.createElement("div");a.className="errorMessage";a.setAttribute("for",b.id);a.setAttribute("htmlFor",b.id);a.appendChild(document.createTextNode(d));b.appendChild(a);b.errorMessage=a;}b.removeError=removeError;if(b.errorControl){b.errorControl.style.background="#ff3300";}if(!firstError){firstError=b;}return false;}function show_status_tip(a,b){submit_tip.style.display="block";submit_tip.innerHTML=a;if(b>0){setTimeout("submit_tip.style.display='none'",b);}}function isDate(c){var a=new Array();if(c.indexOf("-")!=-1){a=c.toString().split("-");}else{if(c.indexOf("/")!=-1){a=c.toString().split("/");}else{return false;}}if(a[0].length==4){var b=new Date(a[0],a[1]-1,a[2]);if(b.getFullYear()==a[0]&&b.getMonth()==a[1]-1&&b.getDate()==a[2]){return true;}}return false;}function verifydata(d,c,e){var a=null;if(c.toLowerCase()=="email"||c.toLowerCase()=="msn"){a=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(d)){return validate_email;}else{return"";}}else{if(c=="日期"||c=="生日"||c=="入学时间"){if(!isDate(d)){return validate_date;}else{return"";}}else{if(c=="固话"){a=/^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$/;if(!a.exec(d)){return validate_phone;}else{return"";}}else{if(c=="手机"){a=/^\d{11}$/;if(!a.exec(d)){return validate_mobile;}else{return"";}}else{if(c=="电话"){a=/(^\d{11}$)|(^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$)/;if(!a.exec(d)){return validate_mo_phone;}else{return"";}}else{if(c=="汉字"){a=/^[\u4e00-\u9fa5]+$/;if(!a.exec(d)){return validate_chinese;}else{return"";}}else{if(c=="英文"){a=/^[A-Za-z]+$/;if(!a.exec(d)){return validate_english;}else{return"";}}else{if(c=="网址"||c=="公司网址"){a=/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;if(!a.exec(d)){return validate_reticulation;}else{return"";}}else{if(c=="身份证号"){a=/^\d{15}(\d{2}[A-Za-z0-9])?$/;if(!a.exec(d)){return validate_idcardNum;}else{return"";}}else{if(c=="数字"){a=/^(\-)?\d+$/;if(!a.exec(d)){return validate_num;}}else{if(c=="小数"){a=/^(\-)?\d+(\.\d+)?$/;if(!a.exec(d)){return validate_decnum;}}else{if(c.toLowerCase()=="qq"){a=/^\d+$/;var b=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(d)&&!b.exec(d)){return validate_qq;}else{return"";}}}}}}}}}}}}}return"";}function verifyMinMax(e,d,c,a){if(d=="数字"||d=="小数"){if(!afterDigitPublish){return"";}var b=/^(\-)?\d+$/;if(d=="小数"){b=/^(\-)?\d+(\.\d+)?$/;}if(!b.exec(e)){if(d=="小数"){return validate_decnum;}else{return validate_num;}}if(c!=""&&parseInt(e)-parseInt(c)<0){return validate_num2+c;}if(a!=""&&parseInt(e)-parseInt(a)>0){return validate_num1+a;}}else{if(a!=""&&e.length-a>0){return validate_info_wd3.format(a,e.length);}if(c!=""&&e.length-c<0){return validate_info_wd4.format(c,e.length);}}return"";}function getXmlHttp(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP");}catch(b){try{a=new XMLHttpRequest();}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP");}catch(b){}}}return a;}if(hasQJump&&window.jqLoaded){jqLoaded();}if(nv==1){var ii=cur_page;for(;ii<totalPage;ii++){if(validate()){to_next_page();}else{break;}}}if(self.location!=top.location){var divpoweredby=document.getElementById("divpoweredby");if(divpoweredby){divpoweredby.style.display="block";}}